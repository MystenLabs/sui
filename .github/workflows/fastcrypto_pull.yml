name: Update the Fastcrypto pointer Sui
on:
  ## Allow triggering this workflow manually via GitHub CLI/web
  workflow_dispatch:
  schedule:
    # Update on every hour at 10 past the hour
    - cron:  '10 * * * *'

jobs:
  update-dep:
    runs-on: ubuntu-latest
    # Important settings as we don't want to open a PR when the update fails
    continue-on-error: false
    strategy:
      fail-fast: true
    steps:
      - uses: actions/checkout@v3
      - uses: bmwill/rust-cache@v1 # Fork of 'Swatinem/rust-cache' which allows caching additional paths
      - name: Install cargo-hakari, and cache the binary
        uses: baptiste0928/cargo-install@30f432979e99f3ea66a8fa2eede53c07063995d8
        with:
          crate: cargo-hakari
          locked: true
      - name: Update the Narwhal pointer
        run: |
          scripts/update_fastcrypto.sh
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
            # TODO: change the token to something FC-specific?
            token: ${{ secrets.NW_AUTO_UPDATE }}
            commit-message: chore(deps) Update the Fastcrypto pointer
            title: chore(deps) Update the Fastcrypto pointer
            body: |
              - Update Fastcrypto
  
              Auto-generated by [create-pull-request][1] and the scripts/update_fastcrypto.sh script
  
              [1]: https://github.com/peter-evans/create-pull-request
            branch: update-fastcrypto
