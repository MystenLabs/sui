name: Tag

on:
  repository_dispatch:
    types: [tag-main]

  workflow_call:
    inputs:
      sui_commit:
        description: 'Sui repo commit to tag'
        type: string
        required: true
      tag_name:
        description: 'Tag Name'
        type: string
        required: true
  workflow_dispatch:
    inputs:
      sui_commit:
        description: 'Sui repo commit to tag'
        type: string
        required: true
      tag_name:
        description: 'Tag Name'
        type: string
        required: true

permissions:
  contents: write

env:
  SUI_COMMIT: "${{ github.event.client_payload.sui_commit || inputs.sui_commit }}"
  TAG_NAME: "${{ github.event.client_payload.tag_name || inputs.tag_name }}"

jobs:
  tag:
    name: Tag
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # pin@v6.0.2
      with:
        fetch-depth: 0
        token: ${{ secrets.SUI_CREATE_RELEASE }}

    - name: Create or update tag
      run: |
        echo "Creating/updating tag $TAG_NAME to point to $SUI_COMMIT"
        git tag -f "$TAG_NAME" "$SUI_COMMIT"
        git push origin "$TAG_NAME" --force
        echo "Tag $TAG_NAME now points to $SUI_COMMIT"
