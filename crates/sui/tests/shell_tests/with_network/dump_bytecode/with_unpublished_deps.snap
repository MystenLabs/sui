---
source: crates/sui/tests/shell_tests.rs
---
----- script -----
# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

# check that using --dump-bytecode-as-base64 and --with-unpublished-deps together works

# update TOMLs with chain id
chain_id=$(sui client --client.config $CONFIG chain-identifier)
echo "[environments]" >> unpublished-dep/Move.toml
echo "localnet = \"$chain_id\"" >> unpublished-dep/Move.toml

echo "[environments]" >> example/Move.toml
echo "localnet = \"$chain_id\"" >> example/Move.toml

echo "should fail without --with-unpublished-deps"
sui move --client.config $CONFIG build --dump-bytecode-as-base64 \
  --path example

echo "should succeed with --with-unpublished-deps"
sui move --client.config $CONFIG build --dump-bytecode-as-base64 \
  --with-unpublished-dependencies \
  --path example

----- results -----
success: true
exit_code: 0
----- stdout -----
should fail without --with-unpublished-deps
The package has unpublished dependencies. If you want to publish with unpublished dependencies, please publish them one by one, or (not recommended) pass the `--with-unpublished-dependencies` flag.
 Unpublished dependencies: unpublished
        
should succeed with --with-unpublished-deps
{"modules":["oRzrCwYAAAAGAQACAwIFBQcBBwgNCBUgDDUHAAAAAQAAAAAHaW52YWxpZARtYWluAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAECAA==","oRzrCwYAAAAGAQACAwIFBQcBBwgFCA0gDC0HAAAAAAAAAAAEbWFpbgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAgA="],"dependencies":[],"digest":[120,30,173,104,125,18,106,120,157,14,228,129,113,170,187,172,53,167,162,225,154,21,181,29,125,31,214,63,35,172,179,111]}

----- stderr -----
INCLUDING DEPENDENCY MoveStdlib
INCLUDING DEPENDENCY Sui
INCLUDING DEPENDENCY unpublished
BUILDING example
