---
source: crates/sui/tests/shell_tests.rs
---
----- script -----
#!/usr/bin/env bash
# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

# Test an ephemeral publication workflow. We have
# B --> A
# C --> B
# C --> A
#
# D --> B
# D --> A
#
# E --> C
# E --> D
#
# We publish A, B, C, D, E (should transitively publish all).

echo "publishing e (using --publish-unpublished-deps)"
sui client --client.config $CONFIG test-publish --build-env testnet \
  --pubfile-path Pub.local.toml --publish-unpublished-deps e \
  > /dev/null || echo "failed to publish e (or one of its transitive dependencies)"

echo "attempting a second ephemeral publish of e, which should fail"
sui client --client.config $CONFIG test-publish --build-env testnet \
  --pubfile-path Pub.local.toml --publish-unpublished-deps e

----- results -----
success: false
exit_code: 1
----- stdout -----
publishing e (using --publish-unpublished-deps)
attempting a second ephemeral publish of e, which should fail
The root package is already published in "Pub.local.toml", consider removing it or using the test-upgrade command

----- stderr -----
Publishing transitive dependency: a
Publishing transitive dependency: b
Publishing transitive dependency: c
Publishing transitive dependency: d
