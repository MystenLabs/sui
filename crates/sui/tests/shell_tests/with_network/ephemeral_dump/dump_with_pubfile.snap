---
source: crates/sui/tests/shell_tests.rs
---
----- script -----
# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

# Test sui move build --dump with --pubfile-path for ephemeral publication

# Get the chain ID from the network
chain_id=$(sui client --client.config $CONFIG chain-identifier)

# Generate the ephemeral pubfile (local source paths must be absolute)
cat > Pub.test.toml <<EOF
# generated by Move
# this file contains metadata from ephemeral publications
# this file should not be committed to source control

build-env = "testnet"
chain-id = "$chain_id"

[[published]]
source = { local = "$PWD/dep_pkg" }
published-at = "0x00000000000000000000000000000000000000000000000000000000CAFECAFE"
original-id = "0x00000000000000000000000000000000000000000000000000000000CAFE0001"
version = 1

[[published]]
source = { local = "$PWD/main_pkg" }
published-at = "0x00000000000000000000000000000000000000000000000000000000BEEFBEEF"
original-id = "0x00000000000000000000000000000000000000000000000000000000BEEF0001"
version = 1
EOF

# Build with --dump using the ephemeral pubfile
# Use --no-tree-shaking since the ephemeral packages don't exist on-chain
sui move --client.config "$CONFIG" build -p main_pkg --dump --pubfile-path Pub.test.toml -e testnet --no-tree-shaking

----- results -----
success: true
exit_code: 0
----- stdout -----
{"modules":["oRzrCwYAAAAGAQAEAwQKBQ4DBxEYCClADGkJAAMBAQAAAAEAAQIAAQAAAQMIY2FsbF9kZXADZGVwBWhlbGxvBG1haW4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK/gABAAEAAAACEQECAA=="],"dependencies":["0x00000000000000000000000000000000000000000000000000000000cafecafe"],"digest":[45,41,146,22,105,95,197,74,240,10,250,126,131,168,26,8,3,132,162,53,58,168,245,212,12,215,196,151,248,157,180,116]}

----- stderr -----
INCLUDING DEPENDENCY dep_pkg
BUILDING main_pkg
