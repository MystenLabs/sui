---
title: Blackjack
description: Learn Sui using an example implementation of the popular casino game Blackjack.
keywords: [ http requests, serverless functions, on-chain randomness, generate randomness, create game, game app, game app, example game ]
---

The following documentation goes through an example implementation of the popular casino game Blackjack on Sui. This guide walks through its components, providing a detailed look at the module's functions, structures, constants, and their significance in the overall gameplay mechanism.

A deployed version of the Blackjack game is online at [Mysten Blackjack](https://blackjack-sui.vercel.app/).

Building an on-chain blackjack game shares a lot of similarities with a Coin Flip game. This example covers the smart contracts (Move modules), backend logic (using serverless functions), and frontend logic.

<ImportContent source="prerequisites.mdx" mode="snippet" />

:::info

For more details on building a backend and deploying to Sui, check out the [Coin Flip app example](./coin-flip.mdx).

You can also find the [full repository for this example here](https://github.com/MystenLabs/blackjack-sui).

:::


## Gameplay

In this single-player version of blackjack, the player competes against a dealer, which is automated by the system. The dealer's actions are triggered by HTTP requests to serverless functions. Players place their bet to start the game. Upon initiating the game, a request is made to the backend (dealer), which processes it by signing and subsequently dealing two cards to the player and one to themselves.

The player has the option to 'Hit' or 'Stand.' Selecting 'Stand' triggers the dealer to draw cards until the total reaches 17 or higher. After the dealer stops, the smart contract steps in to compare the totals and declare the winner. On the other hand, choosing 'Hit' prompts the dealer to draw an additional card for the player.

Note that more complex Blackjack rules, such as splitting, are considered out of scope for this example, and are therefore not implemented.

## Smart contracts

### `single_player_blackjack` module

The [`single_player_blackjack.move`](https://github.com/MystenLabs/blackjack-sui/blob/main/move/blackjack/sources/single_player_blackjack.move) module includes several constants that define game statuses and help track the game's progress:

- `IN_PROGRESS`
- `PLAYER_WON_STATUS`
- `HOUSE_WON_STATUS`
- `TIE_STATUS`

There are also constants for error handling, such as `EUnauthorizedPlayer`, `EInsufficientBalance`, and others, ensuring robust game mechanics.

Structs like `GameCreatedEvent`, `GameOutcomeEvent`, and `HitDoneEvent` capture the various events and actions within a game. The `HitRequest` and `StandRequest` structs ensure that a move (hit/stand) can be performed by the house only if the player has already requested it. `HouseAdminCap` and `HouseData` are crucial for maintaining the house's data, including balance and public key, while the `Game` struct contains all the necessary information about each game, such as player data, cards, and the current status.

The module's functions can be broadly categorized into initialization, game management, and utility functions. The `init` function sets up the house admin capability, while `initialize_house_data` prepares the house for the game by setting up the balance and public key. `place_bet_and_create_game` is the entry point for players to start a new game, involving a bet and random input. The functions `first_deal`, `hit`, and `stand` govern the core gameplay, handling the dealing of cards and player choices.

Utility functions like `get_next_random_card` and `get_card_sum` are essential for the game's mechanics, generating random cards and calculating hand values. The module also includes accessors for retrieving various pieces of game and house data.

For testing purposes, the module provides special functions like `get_house_admin_cap_for_testing`, `player_won_post_handling_for_test` and `house_won_post_handling_for_test`, ensuring that developers can thoroughly test the game mechanics and house data handling.

### On-chain randomness

The Blackjack game leverages Sui's built-in [on-chain randomness module](/guides/developer/advanced/randomness-onchain.mdx) to generate unpredictable and verifiable card values, eliminating the need for external oracles or VRF (Verifiable Random Function) services. This approach ensures fairness and transparency in the game.

The randomness is used in three key scenarios:

1. **Initial deal (`first_deal` function)**: When the game starts, the dealer uses on-chain randomness to deal two cards to the player and one card to the dealer. The function creates a random generator and uses it to generate card values:

```move
let mut random_generator = random::new_generator(r, ctx);
let card1 = get_next_random_card(&mut random_generator, game);
let card2 = get_next_random_card(&mut random_generator, game);
```

2. **Hit action (`hit` function)**: When a player chooses to hit, the dealer draws an additional card using the same randomness mechanism, ensuring each card is truly random and cannot be predicted.

3. **Stand action (`stand` function)**: When a player stands, the dealer automatically draws cards until reaching a sum of 17 or higher, with each card generated using on-chain randomness.

The `get_next_random_card` function uses the random generator to produce a card value between 1 and 13 (representing Ace through King), while also tracking used cards to prevent duplicates within the same game. This implementation ensures that the game outcome is determined fairly and transparently on-chain, with all randomness verifiable through the blockchain.

## Backend

The backend is used for all the transactions that are executed by the dealer. The backend can be completely stateless, and for that reason serverless functions are utilized. As a result, the corresponding code lies under the [`app/src/app/api/` directory](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api).

### Directories structure

The backend code is split in the following sub directories:

- [`games/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/games):
  The main code of the backend endpoints. Each file that is named `route.ts` is served as an endpoint, in the path defined by the project structure (see [Route Segments on NextJS App Router](https://nextjs.org/docs/app/building-your-application/routing#route-segments) for details).
- [`health/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/health): A simple health check endpoint to check the API availability.
- [`helpers/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/helpers): Multiple helper functions used in various endpoints.
- [`services/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/services): The core logic of the backend, that signs and executes the transactions on the Sui blockchain.
- [`utils/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/utils): Reusable methods for signing the transactions as the dealer, and sponsoring them with Shinami, to avoid gas coins equivocation.

### High-Level endpoints specification

| HTTP Method | Path                    | Description                                                   | Request Body                                      |
| ----------- | ----------------------- | ------------------------------------------------------------- | ------------------------------------------------- |
| GET         | `/api/health`           | A simple health check endpoint to check the API availability.   | `txDigest`                                          |
| POST        | `/api/games/{id}/deal`  | Executes the initial deal transaction after the game creation. | `txDigest`                                          |
| POST        | `/api/games/{id}/hit`   | Executes a hit move.                                           | `txDigest`, ID of corresponding `HitRequest` object   |
| POST        | `/api/games/{id}/stand` | Executes a stand move.                                         | `txDigest`, ID of corresponding `StandRequest` object |

### Need of usage of `waitForTransaction`

An interesting aspect of developing an app on Sui, that is coupled to using a full node with/without a load balancer, and requires attention by the developer, is the occurrence of read-after-write and write-after-write cases.

#### Initial deal transaction

As an example, in the Blackjack game, just after the create game transaction that the user executes, the dealer executes the initial deal transaction. This one accepts an argument and modifies the game object, meaning that you are using an object that was just created.

To ensure that the game object is available in the full node that the dealer is using, you need to call `waitForTransaction` after the create game transaction.

#### Hit and stand transactions

In the same way, every time you re-fetch the game object in the frontend, make sure that the previous transaction that modified the game object is already available in the full node.

This leads to the need of exchanging the `txDigest` between the frontend and the backend, and use `waitForTransaction` on each write-after-write or read-after-write case.

## Frontend

The [`page` component](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/page.tsx), a central element of the Blackjack game's frontend module, is structured to create an interactive and responsive gaming experience. Written in React, it integrates several features and functions to handle the game's logic and user interactions effectively.

### Directories structure

The frontend is a NextJS project, that follows the NextJS App Router [project structure](https://nextjs.org/docs/app/building-your-application/routing).
The main code of the frontend lies under the [`app/src/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/) directory.
The main sub-directories are:

- [`app/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/): The main code of the pages and the API endpoints.
- [`components/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components): The reusable components of the app, organized in sub-directories.
- [`hooks/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks): The custom hooks used in the app.
- [`helpers/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/helpers), [`utils/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/utils), [`lib/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/lib): Multiple helper functions and utilities.
- [`types/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/types): The types/interfaces used in the app.
- [`styles/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/styles): The global CSS files to style the app.
- [`__generated__/`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/__generated__): Auto-generated TypeScript bindings from Move contracts (see Codegen section below).

### Codegen

The project uses [`@mysten/codegen`](https://www.npmjs.com/package/@mysten/codegen) to automatically generate type-safe TypeScript bindings from the Move smart contracts. This ensures type safety when interacting with the blockchain from the frontend and backend.

The codegen configuration is defined in [`sui-codegen.config.ts`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/sui-codegen.config.ts):

```typescript
const config: SuiCodegenConfig = {
  output: './src/__generated__',
  generateSummaries: true,
  prune: true,
  packages: [
    {
      package: '@local-pkg/blackjack',
      path: path.join(__dirname, '../move/blackjack'),
    },
  ],
};
```

To generate the TypeScript bindings, run `pnpm codegen` in the `app/` directory. This creates type-safe functions and types in the `__generated__/` folder that match your Move module's functions and structures, making it easier to interact with the smart contracts without manual type definitions.

### Components and custom hooks for state management

- **Custom hooks:** To keep the code as structured as possible, multiple custom hooks are utilized to manage the complex state of the game board at each step. The [`useBlackjackGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useBlackjackGame.ts) custom hook encapsulates the game state and logic, exposing all the required information (with fields such as `game`, `isInitialDealLoading`), and the required functionality (with methods such as `handleCreateGame` and `handleHit`) to display and play the game. Multiple additional custom hooks, such as [`useCreateBlackjackGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useCreateBlackjackGame.ts), and [`useMakeMoveInBlackjackGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useMakeMoveInBlackjackGame.ts) are encapsulating their own piece of state and logic to make the code readable and maintainable.

- **Component for game initialization:** The [`StartGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components/home/StartGame.tsx) component is implemented to facilitate the creation of a new game. It uses the `handleCreateGame` function of the [`useBlackjackGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useBlackjackGame.ts) hook to execute the create-game transaction.

- **Card displaying and management:** The [`DealerCards`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components/home/DealerCards.tsx) and the [`PlayerCards`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components/home/PlayerCards.tsx) components are used to display the total points and the cards owned by the dealer and the player respectively.

- **Game actions:** The [`GameActions`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components/home/GameActions.tsx) component is used to display the **Hit** and **Stand** buttons, and trigger the corresponding actions, as they are exported by the [`useBlackjackGame`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useBlackjackGame.ts) hook to execute the corresponding transactions.

- **`BlackjackBanner`**: The [`BlackjackBanner`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/components/home/BlackjackBanner.tsx) component is used as a custom view to display when the player wins with a blackjack.


### Enoki

The game uses [Enoki](https://docs.enoki.mystenlabs.com/) for transaction sponsorship, enabling users to play the game gas-free. The sponsorship workflow involves two key API endpoints:

#### [`/api/sponsor`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/sponsor/route.ts) endpoint

This endpoint receives the transaction kind bytes and sender address, then creates a sponsored transaction through Enoki. It configures allowed addresses and specific Move call targets for security:

```typescript
const sponsored = await enokiClient.createSponsoredTransaction({
  network: serverConfig.NEXT_PUBLIC_SUI_NETWORK_NAME,
  transactionKindBytes,
  sender: sender,
  allowedAddresses: [sender, serverConfig.NEXT_PUBLIC_ADMIN_ADDRESS],
  allowedMoveCallTargets: [
    getMoveTarget('single_player_blackjack', 'do_hit'),
    getMoveTarget('single_player_blackjack', 'do_stand'),
    getMoveTarget('single_player_blackjack', 'place_bet_and_create_game'),
  ],
});
```

#### [`/api/execute`](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/app/api/execute/route.ts) endpoint

After the user signs the sponsored transaction, this endpoint executes it on Sui:

```typescript
const executionResult = await enokiClient.executeSponsoredTransaction({
  digest,
  signature,
});
```

The complete sponsorship flow is: build transaction → request sponsorship → sign sponsored bytes → execute transaction. This is implemented in the [`useSponsoredTransaction` hook](https://github.com/MystenLabs/blackjack-sui/blob/main/app/src/hooks/useSponsoredTransaction.ts), which handles all player-initiated transactions (creating games, hitting, and standing).


## Comparison: Blackjack and Coin Flip

### Similarities

- **Blockchain-based logic:** Both games are built on Sui, leveraging its capabilities for decentralized applications. The core game logic for each resides in Move modules, ensuring secure and verifiable gameplay.

- **State management:** In both games, state management is crucial. For Blackjack, this involves managing the player and dealer's hands and scores using React state hooks. In Coin Flip, the state is managed through Move structs like `HouseData`, which track the house's balance and other game-related details.

- **Randomness and fair play:** Both games emphasize randomness for fairness. Both games use Sui's [on-chain randomness module](/guides/developer/on-chain-primitives/randomness-onchain.mdx), ensuring verifiable and truly random outcomes for every game.

- **Smart contract interactions:** Each game involves smart contract interactions for game actions like placing bets, dealing cards (Blackjack), or making guesses (Coin Flip). These interactions are crucial for executing the game's logic on the blockchain.

### Differences

- **Game mechanics and complexity:** Blackjack is a more complex game with multiple actions (hit, stand, deal) and state updates, requiring a more dynamic frontend. In contrast, Coin Flip has a simpler mechanic centered around a single bet and guess outcome.

- **User interface (UI) complexity:** The Blackjack game involves a more intricate UI to display cards, manage game states, and player interactions. Coin Flip, being simpler in gameplay, requires a less complex UI.

- **Backend processing:** In Blackjack, the dealer is automated (the machine), and the player's actions directly influence game outcomes. In the Coin Flip game, the house (smart contract) plays a more passive role, primarily in initializing and finalizing the game based on the player's guess.

- **Module structure and focus:** The Blackjack game focuses more on frontend interactions and real-time updates. The Coin Flip game delves into backend logic with structures like `HouseCap` and `house_data` for initializing and managing game data securely on the blockchain.

- **Multi-version implementation:** The Coin Flip game mentions two versions: one susceptible to MEV attacks and another that is resistant, indicating a focus on security and user experience variations. Such variations aren't implemented in Blackjack.

:::info

The complete app example can be found in [the `blackjack-sui` repository](https://github.com/MystenLabs/blackjack-sui).

:::
