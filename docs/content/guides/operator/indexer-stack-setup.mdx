---
title: GraphQL and General-purpose Indexer
description: Setup instructions for running the indexer, consistent store, and GraphQL in production.
keywords: [ indexer, consistent store, graphql, setup, dex ]
---

<ImportContent source="indexer-graphql.mdx" mode="snippet" />

## Indexer setup

The indexer consists of multiple pipelines that each read, transform, and write checkpoint data to a table. These pipelines are grouped together and configured in TOML files. Multiple instances of the indexer run in parallel, each configured by its own TOML file. The grouping is determined by pipeline speed because all pipelines in an instance are limited by the slowest pipeline in that instance.

### Run command

Run an indexer instance using this command for each of the configuration files that follow:

```sh
$ sui-indexer-alt indexer \
    --config CONFIG_FILE
    --database-url DATABASE_URL
    --remote-store-url REMOTE_STORE_URL
```

| CLI param          | Description                                                                                                        |
|--------------------|--------------------------------------------------------------------------------------------------------------------|
| `CONFIG_FILE`      | Path to indexer configuration file.  |
| `DATABASE_URL`     | Postgres database connection string. |
| `REMOTE_STORE_URL` | Location of the checkpoint data to be indexed.<br/>[Data sources](/concepts/custom-indexing-framework#data-sources) |

Example:

```sh
$ sui-indexer-alt indexer \
    --config misc.toml
    --database-url postgres://username:password@localhost:5432/database
    --remote-store-url https://checkpoints.mainnet.sui.io
```

### Run config recommendations {#indexer-run-config}

<table>
<thead>
<tr>
<th>Config TOML</th>
<th>Description</th>
<th>Pipelines</th>
<th>Backfill time</th>
<th>Data retention</th>
</tr>
</thead>
<tbody>
<tr>
<td>`events.toml`</td>
<td>Lightweight event tables.</td>
<td>
    <ul className="pl-4">
        <li>`ev_emit_mod`</li>
        <li>`ev_struct_inst`</li>
    </ul>
</td>
<td>1-2 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `events.toml`
    </summary>
    <ImportContent source="examples/prod-config/events.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`misc.toml`</td>
<td>Lightweight miscellaneous tables.</td>
<td>
    <ul className="pl-4">
        <li>`cp_sequence_numbers`</li>
        <li>`tx_balance_changes`</li>
        <li>`tx_digests`</li>
        <li>`kv_epoch_ends`</li>
        <li>`kv_epoch_starts`</li>
        <li>`kv_feature_flags`</li>
        <li>`kv_packages`</li>
        <li>`kv_protocol_configs`</li>
        <li>`sum_displays`</li>
    </ul>
</td>
<td>2-4 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `misc.toml`
    </summary>
    <ImportContent source="examples/prod-config/misc.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`obj_versions.toml`</td>
<td>Heavyweight object versions table containing data since genesis.</td>
<td>`obj_versions`</td>
<td>10-14 days</td>
<td>unpruned</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `obj_versions.toml`
    </summary>
    <ImportContent source="examples/prod-config/obj_versions.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`tx_affected_addresses.toml`</td>
<td>Midweight transaction table.</td>
<td>`tx_affected_addresses`</td>
<td>1-2 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `tx_affected_addresses.toml`
    </summary>
    <ImportContent source="examples/prod-config/tx_affected_addresses.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`tx_affected_objects.toml`</td>
<td>Midweight transaction table.</td>
<td>`tx_affected_objects`</td>
<td>1-2 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `tx_affected_objects.toml`
    </summary>
    <ImportContent source="examples/prod-config/tx_affected_objects.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`tx_calls.toml`</td>
<td>Midweight transaction table.</td>
<td>`tx_calls`</td>
<td>1-2 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `tx_calls.toml`
    </summary>
    <ImportContent source="examples/prod-config/tx_calls.toml" mode="code" />
    </details>
</td>
</tr>
<tr>
<td>`tx_kinds.toml`</td>
<td>Midweight transaction table.</td>
<td>`tx_kinds`</td>
<td>1-2 days</td>
<td>90 days</td>
</tr>
<tr>
<td colspan={5}>
    <details>
    <summary>
    `tx_kinds.toml`
    </summary>
    <ImportContent source="examples/prod-config/tx_kinds.toml" mode="code" />
    </details>
</td>
</tr>
</tbody>
</table>

### Hardware requirements

- **CPU:** 8 cores
- **Memory:** 16GB

### Storage requirements

**Total:** TBD

| Pipeline              | Table                 | Approximate size (recommended config) |
|-----------------------|-----------------------|--------------------------------------------|
| `cp_sequence_numbers`   | `cp_sequence_numbers`   | TBD                                        |
| `ev_emit_mod`           | `ev_emit_mod`           | TBD                                        |
| `ev_struct_inst`        | `ev_struct_inst`        | TBD                                        |
| `obj_versions`          | `obj_versions`          | TBD                                        |
| `kv_epoch_ends`         | `kv_epoch_ends`         | TBD                                        |
| `kv_epoch_starts`       | `kv_epoch_starts`       | TBD                                        |
| `kv_feature_flags`      | `kv_feature_flags`      | TBD                                        |
| `kv_packages`           | `kv_packages`           | TBD                                        |
| `kv_protocol_configs`   | `kv_protocol_configs`   | TBD                                        |
| `sum_displays`          | `sum_displays`          | TBD                                        |
| `tx_affected_addresses` | `tx_affected_addresses` | TBD                                        |
| `tx_affected_objects`   | `tx_affected_objects`   | TBD                                        |
| `tx_balance_changes`    | `tx_balance_changes`    | TBD                                        |
| `tx_digests`            | `tx_digests`            | TBD                                        |
| `tx_calls`              | `tx_calls`              | TBD                                        |
| `tx_kinds`              | `tx_kinds`              | TBD                                        |

## Consistent store setup

All consistent store pipelines run in the same instance based on a single configuration file. Like the indexer, the pipelines run in parallel and throughput is limited by the slowest pipeline.

### Restore command

Restores one or more pipelines from checkpoint data in a GCS bucket.

```sh
$ sui-indexer-alt-consistent-store restore \
    --database-path DATABASE_PATH \
    --gcs GCS \
    --object-file-concurrency OBJECT_FILE_CONCURRENCY \
    --pipeline PIPELINE_NAME
    --remote-store-url REMOTE_STORE_URL \
```

| CLI parameter                | Description                                                                                                        |
|---------------------------|--------------------------------------------------------------------------------------------------------------------|
| `DATABASE_PATH`           | Path to RocksDB database.                                                                                           |
| `GCS`                     | TBD                                                                                                                |
| `OBJECT_FILE_CONCURRENCY` | Path to indexer configuration file.                                                                                 |
| `PIPELINE_NAME`           | Name of pipeline to restore. Can be set multiple times; once per pipeline.                                       |
| `REMOTE_STORE_URL`        | Location of the checkpoint data to be indexed.<br/>[Data sources](/concepts/custom-indexing-framework#data-sources) |


Example:

```sh
$ sui-indexer-alt-consistent-store restore \
    --database-path /path/to/rocksdb \
    --gcs mysten-testnet-formal \
    --object-file-concurrency 5 \
    --pipeline balances \
    --pipeline object_by_owner \
    --pipeline object_by_type \
    --remote-store-url https://checkpoints.mainnet.sui.io
```

### Run command

Run a consistent store instance using this command for the configuration file that follows:

```sh
$ sui-indexer-alt-consistent-store run \
    --config CONFIG_FILE \
    --database-path DATABASE_PATH
    --remote-store-url REMOTE_STORE_URL \
```

| CLI param          | Description                                                                                                        |
|--------------------|--------------------------------------------------------------------------------------------------------------------|
| `CONFIG_FILE`      | Path to consistent store configuration file.                                                                        |
| `DATABASE_PATH`    | Path to RocksDB database.                                                                                           |
| `REMOTE_STORE_URL` | Location of the checkpoint data to be indexed.<br/>[Data sources](/concepts/custom-indexing-framework#data-sources) |

Example:

```sh
$ sui-indexer-alt-consistent-store run \
    --config consistent_store.toml \
    --database-path /path/to/rocksdb
    --remote-store-url https://checkpoints.mainnet.sui.io \
```

### Run config recommendations

<table>
<thead>
<tr>
<th>Config TOML</th>
<th>Description</th>
<th>Pipelines</th>
<th>Backfill time</th>
<th>Data retention</th>
</tr>
</thead>
<tbody>
<tr>
<td>`consistent_store.toml`</td>
<td>Consistent store API configuration and event tables.</td>
<td><ul className="pl-4">
        <li>`balances`</li>
        <li>`object-by-owner`</li>
        <li>`object-by-type`</li>
    </ul></td>
<td>TBD</td>
<td>Unpruned</td>
</tr>
</tbody>
</table>

<details>
<summary>
`consistent_store.toml`
</summary>
    <ImportContent source="examples/prod-config/consistent_store.toml" mode="code" />
</details>


### Hardware requirements

- **CPU:** 8 cores
- **Memory:** 32GB

### Storage requirements

**total:** TBD

| Pipeline        | Table           | Approximate size (recommended config) |
|-----------------|-----------------|--------------------------------------------|
| balances        | balances        | TBD                                        |
| object-by-owner | object-by-owner | TBD                                        |
| object-by-type  | object-by-type  | TBD                                        |

## GraphQL setup

GraphQL instances read data from the indexer and the consistent store. The number of instances is determined by the required read throughput.

### Run command

Each GraphQL instance is run using the same command:

```sh
$ sui-indexer-alt-graphql rpc \
    --config CONFIG_FILE \
    --indexer-config INDEXER_CONFIG_FILE \
    --bigtable-instance BIGTABLE_INSTANCE \
    --consistent-store-url CONSISTENT_STORE_URL \
    --database-url DATABASE_URL \
    --fullnode-rpc-url FULLNODE_RPC_URL
```

| CLI param              | Description                                                                        |
|------------------------|------------------------------------------------------------------------------------|
| `CONFIG_FILE`          | Path to GraphQL configuration file                                                 |
| `INDEXER_CONFIG_FILE`  | Path to indexer configuration file<br/>Can be set multiple times; once per indexer |
| `BIGTABLE_INSTANCE`    | GCP Bigtable instance                                                              |
| `CONSISTENT_STORE_URL` | URL to [consistent store](#consistent-store-setup) API                             |
| `DATABASE_URL`         | Postgres database connection string                                                |
| `FULLNODE_RPC_URL`     | URL to fullnode RPC API                                                            |


Example:

```sh
$ sui-indexer-alt-graphql rpc \
    --config graphql.toml \
    --indexer-config events.toml \
    --indexer-config misc.toml \
    --indexer-config obj_versions.toml \
    --indexer-config tx_affected_addresses.toml \
    --indexer-config tx_affected_objects.toml \
    --indexer-config tx_calls.toml \
    --indexer-config tx_kinds.toml \
    --bigtable-instance kv-store-mainnet \
    --consistent-store-url https://localhost:7001 \
    --database-url postgres://username:password@localhost:5432/database \
    --fullnode-rpc-url https://localhost:9000
```

### Run config recommendations

| Config TOML                                                                                   | Description                       |
|-----------------------------------------------------------------------------------------------|-----------------------------------|
| `graphql.toml` | Default GraphQL API configuration. |

<details>
<summary>
`graphql.toml`
</summary>
    <ImportContent source="examples/prod-config/graphql.toml" mode="code" />
</details>

[Indexer Config](#indexer-run-config)

### Hardware requirements

- **CPU:** 8 cores
- **Memory:** 32GB

