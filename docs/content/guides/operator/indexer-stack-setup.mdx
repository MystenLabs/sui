---
title: GraphQL and General-Purpose Indexer
description: Setup instructions for running the indexer, consistent store, and GraphQL in production.
keywords: [indexer, consistent store, graphql, setup, dex]
---

<ImportContent source="indexer-graphql.mdx" mode="snippet" />

See [GraphQL and General-Purpose Indexer](/concepts/data-access/graphql-indexer.mdx) for more information on the stack.

## Indexer setup

The indexer consists of multiple pipelines that each read, transform, and write checkpoint data to a table. Multiple instances of the indexer can run in parallel, each configured by its own TOML file.

#### Hardware requirements

- **CPU:** 2 cores per instance
- **Memory:** 4GB per instance

#### Storage requirements
The general-purpose indexer writes to a Postgres database. The storage footprint estimations outlined below are based on the network as of early 2026, and may fluctuate in relation to network growth. These numbers should be seen as directional rather than exact figures.

The bulk of the storage is consumed by `obj_versions` at 8.2 TB. A pruning strategy is in development.

A 30-day retention adds 1.8 TB on top, while a 90-day retention contributes up to an additional 3.1 TB.

30-day retention:

| Table | Heap (GB) | Idx (GB) |
|-------|-----------|-----------------|
| tx_affected_objects | 64–70 | 276–397 |
| tx_calls | 27–30 | 239–366 |
| ev_struct_inst | 15–19 | 174–267 |
| tx_affected_addresses | 17–18 | 63–92 |
| ev_emit_mod | 8–9 | 54–85 |
| tx_balance_changes | 18–20 | 5–6 |
| tx_digests | 8 | 21–25 |
| tx_kinds | 5 | 14–16 |
| cp_sequence_numbers | 10 | 5 |
| **TOTAL** | **444–450** | **1,827–1,842** |

90-day retention:

| Table | Heap (GB) | Idx (GB) |
|-------|-----------|-----------------|
| tx_affected_objects | 188–202 | 580–752 |
| tx_calls | 82–87 | 560–715 |
| ev_struct_inst | 45–50 | 432–531 |
| tx_affected_addresses | 50–54 | 151–183 |
| ev_emit_mod | 22–24 | 129–167 |
| tx_balance_changes | 57–63 | 10–16 |
| tx_digests | 24–26 | 45–55 |
| tx_kinds | 15–16 | 30–36 |
| cp_sequence_numbers | 10 | 5 |
| **TOTAL** | **755–842** | **2,440–3,181** |

### Pipeline categories

The indexer pipelines are divided into two categories based on their data retention requirements:

#### Unpruned pipelines (must index from genesis)
These pipelines contain foundational data that must be indexed from genesis (checkpoint 0):
- `obj_versions.toml` - Object versions table containing complete object version to checkpoint sequence number mappings since genesis
- `unpruned.toml` - Foundational reference data and smaller kv tables

:::warning GraphQL Service Dependency
The GraphQL RPC service will only operate normally once unpruned pipelines have caught up to the network tip. Plan accordingly as these pipelines can take 10-14 days to fully backfill from genesis.
:::

#### Pruned pipelines (can start from recent checkpoint)
These pipelines can be configured with a `first-checkpoint` parameter based on your retention requirements:
- `events.toml`
- `tx_affected_addresses.toml`
- `tx_affected_objects.toml`
- `tx_calls.toml`
- `tx_kinds.toml`

For pruned pipelines, calculate the `first-checkpoint` based on your retention period:
- **30-day retention**: Start from checkpoint `current_checkpoint - 10368000`
- **90-day retention**: Start from checkpoint `current_checkpoint - 31104000`

### Run `sui-indexer-alt`

Run an indexer instance using this command for each of the configuration files:

#### For unpruned pipelines (must start from genesis)
```sh
$ sui-indexer-alt indexer \
    --config <CONFIG_FILE> \
    --database-url <DATABASE_URL> \
    --remote-store-url <REMOTE_STORE_URL>
```

#### For pruned pipelines with retention period
```sh
$ sui-indexer-alt indexer \
    --config <CONFIG_FILE> \
    --database-url <DATABASE_URL> \
    --remote-store-url <REMOTE_STORE_URL> \
    --first-checkpoint <CHECKPOINT_NUMBER>
```

| **CLI param**            | **Description**                                                                                                                          |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `<CONFIG_FILE>`      | Path to indexer configuration file.                                                                                                  |
| `<DATABASE_URL>`     | Postgres database connection string.                                                                                                 |
| `<REMOTE_STORE_URL>` | URL of a checkpoint bucket to index from, one of multiple possible [data sources](/guides/developer/accessing-data/custom-indexing-framework#data-sources). |
| `<CHECKPOINT_NUMBER>`| (Optional) For pruned pipelines only - the checkpoint to start indexing from based on retention requirements.                        |

#### Examples

**Unpruned pipeline (from genesis):**
```sh
$ sui-indexer-alt indexer \
    --config unpruned.toml \
    --database-url postgres://username:password@localhost:5432/database \
    --remote-store-url https://checkpoints.mainnet.sui.io
```

**Pruned pipeline with 30-day retention (assuming current checkpoint is 100,000,000):**
```sh
$ sui-indexer-alt indexer \
    --config events.toml \
    --database-url postgres://username:password@localhost:5432/database \
    --remote-store-url https://checkpoints.mainnet.sui.io \
    --first-checkpoint 97408000
```

### Run config recommendations {#indexer-run-config}

Use the TOML files below; they are grouped by pipeline speed. All pipelines in an instance are limited by the slowest pipeline in that instance so these files each contain pipelines that run at approximately the same speed.

:::info
When backfilling, you should set the `ingest-concurrency` to a higher value, e.g. 200, then reduce it to 20 for normal operation at network tip.
:::

<table>
	<thead>
		<tr>
			<th>Config TOML</th>
			<th>Type</th>
			<th>Description</th>
			<th>Pipelines</th>
			<th>Backfill time</th>
			<th>Data retention</th>
			<th>Start checkpoint</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>`events.toml`</td>
			<td>**Pruned**</td>
			<td>Lightweight event tables.</td>
			<td>
				<ul className="pl-4">
					<li>`ev_emit_mod`</li>
					<li>`ev_struct_inst`</li>
				</ul>
			</td>
			<td>1-2 days</td>
			<td>90 days</td>
			<td>Based on retention</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`events.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/events.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`obj_versions.toml`</td>
			<td>**Unpruned**</td>
			<td>Heavyweight object versions table containing data since genesis.</td>
			<td>`obj_versions`</td>
			<td>10-14 days</td>
			<td>Unpruned</td>
			<td>Must start from genesis (0)</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`obj_versions.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/obj_versions.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`tx_affected_addresses.toml`</td>
			<td>**Pruned**</td>
			<td>Midweight transaction table.</td>
			<td>`tx_affected_addresses`</td>
			<td>1-2 days</td>
			<td>90 days</td>
			<td>Based on retention</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`tx_affected_addresses.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/tx_affected_addresses.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`tx_affected_objects.toml`</td>
			<td>**Pruned**</td>
			<td>Midweight transaction table.</td>
			<td>`tx_affected_objects`</td>
			<td>1-2 days</td>
			<td>90 days</td>
			<td>Based on retention</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`tx_affected_objects.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/tx_affected_objects.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`tx_calls.toml`</td>
			<td>**Pruned**</td>
			<td>Midweight transaction table.</td>
			<td>`tx_calls`</td>
			<td>1-2 days</td>
			<td>90 days</td>
			<td>Based on retention</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`tx_calls.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/tx_calls.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`tx_kinds.toml`</td>
			<td>**Pruned**</td>
			<td>Midweight transaction table.</td>
			<td>`tx_kinds`</td>
			<td>1-2 days</td>
			<td>90 days</td>
			<td>Based on retention</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`tx_kinds.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/tx_kinds.toml" mode="code" />
				</details>
			</td>
		</tr>
		<tr>
			<td>`unpruned.toml`</td>
			<td>**Unpruned**</td>
			<td>Foundational and reference data that other queries and parts of the indexer depend on.</td>
			<td>
				<ul className="pl-4">
					<li>`cp_sequence_numbers`</li>
					<li>`kv_epoch_ends`</li>
					<li>`kv_epoch_starts`</li>
					<li>`kv_feature_flags`</li>
					<li>`kv_packages`</li>
					<li>`kv_protocol_configs`</li>
					<li>`sum_displays`</li>
					<li>`tx_balance_changes`</li>
					<li>`tx_digests`</li>
				</ul>
			</td>
			<td>2-4 days</td>
			<td>Unpruned</td>
			<td>Must start from genesis (0)</td>
		</tr>
		<tr>
			<td colspan={7}>
				<details>
					<summary>`unpruned.toml`</summary>
					<ImportContent source="examples/prod-config/indexer/unpruned.toml" mode="code" />
				</details>
			</td>
		</tr>
	</tbody>
</table>

## Consistent store setup

All consistent store pipelines run in the same instance based on a single configuration file. Like the indexer, the pipelines run in parallel and throughput is limited by the slowest pipeline.

#### Hardware requirements

- **CPU:** 8 cores
- **Memory:** 32GB

### Restore command

Restores one or more pipelines from checkpoint data in a GCS bucket.

```sh
$ sui-indexer-alt-consistent-store restore \
    --azure <AZURE_BUCKET> \
    --database-path <DATABASE_PATH> \
    --gcs <GCS_BUCKET> \
    --http <HTTP_ENDPOINT> \
    --object-file-concurrency <OBJECT_FILE_CONCURRENCY> \
    --pipeline <PIPELINE_NAME> \
    --remote-store-url <REMOTE_STORE_URL> \
    --s3 <S3_BUCKET>
```

| CLI parameter               | Description                                                                                                                               |
| --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `<AZURE_BUCKET>` \*         | Name or URL of Azure bucket containing [managed snapshots](https://docs.sui.io/guides/operator/snapshots#mysten-labs-managed-snapshots).  |
| `<DATABASE_PATH>`           | Path to RocksDB database.                                                                                                                 |
| `<GCS_ACCOUNT>` \*          | Name or URL of GCS bucket containing [managed snapshots](https://docs.sui.io/guides/operator/snapshots#mysten-labs-managed-snapshots).    |
| `<HTTP_ENDPOINT>` \*        | URL of formal snapshot API.                                                                                                               |
| `<OBJECT_FILE_CONCURRENCY>` | Path to indexer configuration file.                                                                                                       |
| `<PIPELINE_NAME>`           | Name of pipeline to restore. Can be set multiple times; once per pipeline.                                                                |
| `<REMOTE_STORE_URL>`        | URL of a checkpoint bucket to index from, one of multiple possible [data sources](/guides/developer/accessing-data/custom-indexing-framework#data-sources).      |
| `<S3_BUCKET>` \*            | Name or URL of AWS S3 bucket containing [managed snapshots](https://docs.sui.io/guides/operator/snapshots#mysten-labs-managed-snapshots). |

\* Must specify one of `<AZURE_BUCKET>`, `<GCS_ACCOUNT>`, `<HTTP_ENDPOINT>`, or `<S3_BUCKET>`.

Example:

```sh
$ sui-indexer-alt-consistent-store restore \
    --database-path /path/to/rocksdb \
    --http https://formal-snapshot.mainnet.sui.io \
    --object-file-concurrency 5 \
    --pipeline balances \
    --pipeline object_by_owner \
    --pipeline object_by_type \
    --remote-store-url https://checkpoints.mainnet.sui.io
```

### Run command

Run a consistent store instance using this command for the configuration file that follows:

```sh
$ sui-indexer-alt-consistent-store run \
    --config <CONFIG_FILE> \
    --database-path <DATABASE_PATH> \
    --remote-store-url <REMOTE_STORE_URL>
```

| CLI param            | Description                                                                                                                          |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `<CONFIG_FILE>`      | Path to consistent store configuration file.                                                                                         |
| `<DATABASE_PATH>`    | Path to RocksDB database.                                                                                                            |
| `<REMOTE_STORE_URL>` | URL of a checkpoint bucket to index from, one of multiple possible [data sources](/guides/developer/accessing-data/custom-indexing-framework#data-sources). |

Example:

```sh
$ sui-indexer-alt-consistent-store run \
    --config consistent-store.toml \
    --database-path /path/to/rocksdb \
    --remote-store-url https://checkpoints.mainnet.sui.io
```

### Run config recommendations

<table>
	<thead>
		<tr>
			<th>Config TOML</th>
			<th>Description</th>
			<th>Pipelines</th>
			<th>Backfill time</th>
			<th>Data retention</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>`consistent-store.toml`</td>
			<td>Consistent store API configuration and event tables.</td>
			<td>
				<ul className="pl-4">
					<li>`balances`</li>
					<li>`object-by-owner`</li>
					<li>`object-by-type`</li>
				</ul>
			</td>
			<td>1-2 hours</td>
			<td>Unpruned</td>
		</tr>
	</tbody>
</table>

<details>
	<summary>`consistent-store.toml`</summary>
	<ImportContent source="examples/prod-config/consistent_store.toml" mode="code" />
</details>

## GraphQL RPC server setup

GraphQL RPC server reads data from the general-purpose indexer's database (Postgres), the consistent store, and the [archival service](/guides/developer/accessing-data/archival-store.mdx).

:::warning Prerequisites
Before starting the GraphQL RPC server, ensure that **all unpruned indexer pipelines** (`obj_versions.toml` and `unpruned.toml`) have fully caught up with the pruned pipelines.
:::

#### Hardware requirements

- **CPU:** 2 cores per instance
- **Memory:** 4GB per instance

Scale the number of nodes based on the desired read throughput requirements of your client applications.

### GraphQL RPC server dependencies

The GraphQL RPC server relies on multiple backend services to fulfill different types of queries:
- Archival service (`--ledger-grpc-url`) provides historical data for most queries involving checkpoints, objects, and transactions.
- Consistent store (`--consistent-store-url`) serves live data for queries related to current object and balance ownership.
- Postgres database (`--database-url`) is the primary store for most queries, except for direct object and transaction lookups handled by the Archival service.
- Fullnode RPC (`--fullnode-rpc-url`) powers transaction simulation and execution.

Set the appropriate service URLs in your run command based on the query types your GraphQL RPC server needs to support.

### Run `sui-indexer-alt-graphql`

:::info

If you use the Sui Foundation–hosted public good archival service on Testnet or Mainnet, you may encounter performance issues. The team will address these before the GraphQL RPC and Archival Service reach general availability.

:::

Use the following command to run a GraphQL RPC server node:
```sh
sui-indexer-alt-graphql rpc \
    --config <PATH_TO_GRAPHQL_CONFIG_FILE> \
    --indexer-config <PATH_TO_INDEXER_CONFIG_FILE_1> \
    --indexer-config <PATH_TO_INDEXER_CONFIG_FILE_2> \
    --indexer-config <PATH_TO_INDEXER_CONFIG_FILE_3> \
    --ledger-grpc-url <LEDGER_GRPC_URL> \
    --consistent-store-url <CONSISTENT_STORE_URL> \
    --database-url <DATABASE_URL> \
    --fullnode-rpc-url <FULLNODE_RPC_URL>
```

Multiple `--indexer-config` parameters can be provided, one for each general-purpose indexer instance.

| CLI parameter                        | Description                                                                        |
|----------------------------------|------------------------------------------------------------------------------------|
| `CONFIG_FILE`                    | Path to the optional GraphQL RPC server configuration file |
| `INDEXER_CONFIG_FILE`            | Path to general-purpose indexer configuration file; can be set multiple times for different pipelines                 |
| `LEDGER_GRPC_URL`                | URL to Archival service's `LedgerService` gRPC API                                   |
| `CONSISTENT_STORE_URL`           | URL to [Consistent store](#consistent-store-setup) API                             |
| `DATABASE_URL`                   | Postgres database connection string                                                |
| `FULLNODE_RPC_URL`               | URL to full node RPC                                                            |


Example:
```sh
sui-indexer-alt-graphql rpc \
    --config graphql.toml \
    --indexer-config events.toml \
    --indexer-config obj_versions.toml \
    --indexer-config tx_affected_addresses.toml \
    --indexer-config tx_affected_objects.toml \
    --indexer-config tx_calls.toml \
    --indexer-config tx_kinds.toml \
    --indexer-config unpruned.toml \
    --ledger-grpc-url https://archive.mainnet.sui.io:443 \
    --consistent-store-url https://localhost:7001 \
    --database-url postgres://username:password@localhost:5432/database \
    --fullnode-rpc-url https://localhost:9000
```

### Generating Configuration

You can run the GraphQL RPC server without a configuration file, which will use default values. To customize settings, generate a config file using the command below and edit it as needed:

```sh

sui-indexer-alt-graphql generate-config > <PATH_TO_GRAPHQL_CONFIG_FILE>
```

It will produce output similar to the following:

<details>
	<summary>`graphql.toml`</summary>
	<ImportContent source="examples/prod-config/graphql.toml" mode="code" />
</details>

## Indexer/GraphQL Postgres-compatible Database Setup

Both the indexer and GraphQL server require a Postgres-compatible database shared between them.

These GraphQL request throughputs were tested against the following recommended specs:
- 500 requests per second when the indexer is backfilling from genesis or running a restore
- 1000 requests per second when the indexer is indexing from the network tip (~4.25 checkpoints per second)

### AlloyDB Omni

AlloyDB Omni recommends 8GB RAM per vCPU [link](https://docs.cloud.google.com/alloydb/omni/containers/current/docs/plan-installation#hardware). Allocating less than this results in the database closing Indexer and GraphQL connections during load testing.

#### Hardware requirements

- **CPU:** 6 cores
- **Memory:** 48GB

### Vanilla Postgres

#### Hardware requirements

- **CPU:** 6 cores
- **Memory:** 48GB

## Related links

<RelatedLink to="/concepts/data-access/graphql-indexer" />
<RelatedLink to="/concepts/data-access/graphql-rpc" />
<RelatedLink to="/guides/developer/accessing-data/custom-indexing-framework" />
<RelatedLink to="/guides/developer/accessing-data/pipeline-architecture" />
<RelatedLink to="/guides/developer/accessing-data/archival-store" />
<RelatedLink
	href="https://github.com/MystenLabs/sui/tree/main/crates/sui-indexer-alt"
	label="Sui Indexer Alt"
	desc="The `sui-indexer-alt` crate in the Sui repo."
/>
<RelatedLink
	href="https://github.com/MystenLabs/mvr/tree/main/crates/mvr-indexer"
	label="Move Registry"
	desc="The indexer that the Move Registry (MVR) implements."
/>
<RelatedLink
	href="https://github.com/MystenLabs/deepbookv3/tree/main/crates/indexer"
	label="DeepBook Indexer"
	desc="The indexer that DeepBook implements."
/>
<RelatedLink
	href="/references/sui-api/sui-graphql/beta/reference"
	label="GraphQL Beta schema"
	desc="Schema documentation for GraphQL Beta"
/>
