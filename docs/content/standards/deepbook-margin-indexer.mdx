---
title: DeepBook Margin Indexer
sidebar_label: Indexer
description: DeepBook Margin Indexer provides access to margin trading events including loans, liquidations, and margin pool operations.
keywords: [DeepBook Margin Indexer, margin manager, margin pool, liquidation, loan, borrow, repay, supply, withdraw]
---

The DeepBook Margin Indexer extends the DeepBookV3 Indexer with endpoints for margin trading data. These endpoints provide access to margin manager events, margin pool operations, and liquidation monitoring.

## Public endpoint

The margin endpoints are available through the same public indexer as DeepBookV3.

### Mainnet

```http
https://deepbook-indexer.mainnet.mystenlabs.com/
```

### Testnet

```http
https://deepbook-indexer.testnet.mystenlabs.com/
```

## Common query parameters

All margin endpoints support the following common query parameters:

- `start_time`: Start of time range in Unix timestamp seconds (defaults to 24 hours ago)
- `end_time`: End of time range in Unix timestamp seconds (defaults to current time)
- `limit`: Maximum number of results to return (defaults to 1)

## Margin manager endpoints

### Get margin manager creation events

```http
/margin_manager_created?margin_manager_id=<ID>
```

Returns events for when margin managers are created.

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "owner": "0xabcd...",
        "balance_manager_id": "0x5678...",
        "deepbook_pool_id": "0x9abc...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get loan borrowed events

```http
/loan_borrowed?margin_manager_id=<ID>&margin_pool_id=<ID>
```

Returns events for when assets are borrowed from margin pools.

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "margin_pool_id": "0x5678...",
        "borrow_amount": "1000000000",
        "borrow_shares": "1000000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get loan repaid events

```http
/loan_repaid?margin_manager_id=<ID>&margin_pool_id=<ID>
```

Returns events for when borrowed assets are repaid.

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "margin_pool_id": "0x5678...",
        "repay_amount": "1000000000",
        "repay_shares": "1000000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get liquidation events

```http
/liquidation?margin_manager_id=<ID>&margin_pool_id=<ID>
```

Returns events for when margin managers are liquidated.

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "margin_pool_id": "0x5678...",
        "liquidator": "0xabcd...",
        "repay_amount": "1000000000",
        "collateral_amount": "500000000",
        "liquidator_reward": "50000000",
        "pool_reward": "10000000",
        "bad_debt": "0",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get margin managers info

```http
/margin_managers_info
```

Returns an aggregate view of all margin managers with their associated pool and asset information.

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "deepbook_pool_id": "0x5678...",
        "base_asset_id": "0xabcd...",
        "base_asset_symbol": "SUI",
        "quote_asset_id": "0xefgh...",
        "quote_asset_symbol": "USDC",
        "base_margin_pool_id": "0x1111...",
        "quote_margin_pool_id": "0x2222..."
    }
]
```

### Get margin manager states

```http
/margin_manager_states?max_risk_ratio=<FLOAT>&deepbook_pool_id=<ID>
```

Returns the current state of margin managers. This endpoint is useful for monitoring positions that may be at risk of liquidation.

- `max_risk_ratio`: Filter to return only margin managers with risk ratio below this threshold (useful for finding liquidation opportunities)
- `deepbook_pool_id`: Filter by specific DeepBook pool

#### Response

```json
[
    {
        "margin_manager_id": "0x1234...",
        "deepbook_pool_id": "0x5678...",
        "owner": "0xabcd...",
        "base_assets": "1000000000",
        "quote_assets": "5000000000",
        "base_debt": "500000000",
        "quote_debt": "2000000000",
        "risk_ratio": 1.5
    }
]
```

## Margin pool endpoints

### Get asset supplied events

```http
/asset_supplied?margin_pool_id=<ID>&supplier=<ADDRESS>
```

Returns events for when assets are supplied to margin pools.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "supplier": "0xabcd...",
        "supplier_cap_id": "0x5678...",
        "supply_amount": "1000000000",
        "supply_shares": "1000000000",
        "referral_id": "0x9abc...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get asset withdrawn events

```http
/asset_withdrawn?margin_pool_id=<ID>&supplier=<ADDRESS>
```

Returns events for when assets are withdrawn from margin pools.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "supplier": "0xabcd...",
        "supplier_cap_id": "0x5678...",
        "withdraw_amount": "1000000000",
        "withdraw_shares": "1000000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get margin pool creation events

```http
/margin_pool_created?margin_pool_id=<ID>
```

Returns events for when margin pools are created.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "asset_type": "0x2::sui::SUI",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get DeepBook pool updated events

```http
/deepbook_pool_updated?margin_pool_id=<ID>&deepbook_pool_id=<ID>
```

Returns events for when DeepBook pools are enabled or disabled for a margin pool.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "deepbook_pool_id": "0x5678...",
        "allowed": true,
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get interest params updated events

```http
/interest_params_updated?margin_pool_id=<ID>
```

Returns events for when interest rate parameters are updated.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "base_rate": "100000",
        "multiplier": "200000",
        "jump_multiplier": "500000",
        "optimal_utilization": "800000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get margin pool config updated events

```http
/margin_pool_config_updated?margin_pool_id=<ID>
```

Returns events for when margin pool configuration is updated.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "supply_cap": "10000000000000",
        "max_utilization_rate": "950000000",
        "protocol_spread": "50000000",
        "min_borrow": "1000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get supplier cap minted events

```http
/supplier_cap_minted?supplier_cap_id=<ID>
```

Returns events for when supplier capabilities are minted.

#### Response

```json
[
    {
        "supplier_cap_id": "0x1234...",
        "owner": "0xabcd...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get supply referral minted events

```http
/supply_referral_minted?margin_pool_id=<ID>&owner=<ADDRESS>
```

Returns events for when supply referrals are minted.

#### Response

```json
[
    {
        "referral_id": "0x1234...",
        "margin_pool_id": "0x5678...",
        "owner": "0xabcd...",
        "referral_rate": "100000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get protocol fees increased events

```http
/protocol_fees_increased?margin_pool_id=<ID>
```

Returns events for when protocol fees are increased.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "amount": "1000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get referral fees claimed events

```http
/referral_fees_claimed?referral_id=<ID>&owner=<ADDRESS>
```

Returns events for when referral fees are claimed.

#### Response

```json
[
    {
        "referral_id": "0x1234...",
        "margin_pool_id": "0x5678...",
        "owner": "0xabcd...",
        "amount": "1000000",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

## Admin and registry endpoints

### Get maintainer cap updated events

```http
/maintainer_cap_updated?maintainer_cap_id=<ID>
```

Returns events for when maintainer capabilities are updated.

#### Response

```json
[
    {
        "maintainer_cap_id": "0x1234...",
        "owner": "0xabcd...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get maintainer fees withdrawn events

```http
/maintainer_fees_withdrawn?margin_pool_id=<ID>
```

Returns events for when maintainer fees are withdrawn.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "amount": "1000000",
        "recipient": "0xabcd...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get protocol fees withdrawn events

```http
/protocol_fees_withdrawn?margin_pool_id=<ID>
```

Returns events for when protocol fees are withdrawn.

#### Response

```json
[
    {
        "margin_pool_id": "0x1234...",
        "amount": "1000000",
        "recipient": "0xabcd...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get pause cap updated events

```http
/pause_cap_updated?pause_cap_id=<ID>
```

Returns events for when pause capabilities are updated.

#### Response

```json
[
    {
        "pause_cap_id": "0x1234...",
        "owner": "0xabcd...",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get DeepBook pool registered events

```http
/deepbook_pool_registered?pool_id=<ID>
```

Returns events for when DeepBook pools are registered in the margin registry.

#### Response

```json
[
    {
        "pool_id": "0x1234...",
        "base_type": "0x2::sui::SUI",
        "quote_type": "0xdba3...::usdc::USDC",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get DeepBook pool registry updated events

```http
/deepbook_pool_updated_registry?pool_id=<ID>
```

Returns events for when DeepBook pool registry entries are updated.

#### Response

```json
[
    {
        "pool_id": "0x1234...",
        "margin_enabled": true,
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

### Get DeepBook pool config updated events

```http
/deepbook_pool_config_updated?pool_id=<ID>
```

Returns events for when DeepBook pool configurations are updated.

#### Response

```json
[
    {
        "pool_id": "0x1234...",
        "initial_margin_ratio": "100000000",
        "maintenance_margin_ratio": "50000000",
        "liquidation_reward": "50000000",
        "max_leverage": "10",
        "checkpoint_timestamp_ms": 1738000000000
    }
]
```

## Related links

<RelatedLink
	href="https://github.com/MystenLabs/deepbookv3"
	label="DeepBookV3 repository"
	desc="The DeepBookV3 repository on GitHub."
/>
